<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seattle Blues Underground - Social Blues Dancing</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a1a2e;
            --secondary-color: #16213e;
            --accent-color: #3a6ea5;
            --accent-light: #4a8bc5;
            --accent-dark: #2a5a8a;
            --background-color: #f8f9fa;
            --text-color: #1a1a2e;
            --text-light: #6c757d;
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        header {
            position: relative;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 0;
            overflow: hidden;
            z-index: 1;
        }

        .header-image {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
            width: 100%;
            box-sizing: border-box;
        }

        .filters {
            background-color: white;
            padding: 0;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin: -3rem auto 1.5rem;
            position: relative;
            z-index: 1;
        }

        html {
            scroll-behavior: smooth;
        }

        .filter-toggle {
            padding: 1rem;
            background-color: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 2;
        }

        .filter-toggle:hover {
            background-color: #f8f9fa;
        }

        .filter-toggle-text {
            font-weight: 600;
            color: var(--text-color);
        }

        .filter-toggle-icon {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid var(--text-color);
            transition: transform 0.3s ease;
        }

        .filter-toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .filter-content {
            padding: 1.5rem;
            max-height: 1000px;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
            position: relative;
            padding-bottom: 2rem;
        }

        .reset-filters {
            position: absolute;
            bottom: 1rem;
            right: 1.5rem;
            color: #e57373;
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.25rem;
            opacity: 0;
            pointer-events: none;
        }

        .reset-filters:hover {
            color: #d32f2f;
            text-decoration: underline;
        }

        .reset-filters.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .reset-filters::before {
            content: "Ã—";
            font-size: 1.1rem;
            font-weight: 500;
        }

        .filters.collapsed .filter-content {
            max-height: 0;
            opacity: 0;
            padding: 0;
            overflow: hidden;
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            width: 100%;
            color: var(--text-color);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-option {
            padding: 0.5rem 1rem;
            background-color: var(--background-color);
            border: 1px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .filter-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(58, 110, 165, 0.1);
        }

        .filter-option.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .events-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .events-section {
                grid-template-columns: 1fr 1fr;
            }
        }

        .upcoming-events {
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            max-height: 500px;
            overflow-y: auto;
        }

        .events-week {
            margin-bottom: 1.5rem;
        }

        .events-week:last-child {
            margin-bottom: 0;
        }

        .week-header {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-color);
        }

        .event-card {
            border-bottom: 1px solid #e9ecef;
            padding: 1.25rem 0;
            transition: var(--transition);
        }

        .event-date {
            font-weight: 500;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .event-title {
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .event-details {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .event-tag {
            background-color: var(--background-color);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-color);
            transition: var(--transition);
        }

        .event-tag:hover {
            background-color: var(--accent-color);
            color: white;
        }

        .calendar {
            min-height: 400px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-controls button {
            padding: 0.5rem 1rem;
            background-color: var(--background-color);
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .calendar-controls button:hover {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            width: 100%;
        }

        .calendar-day {
            aspect-ratio: 1;
            padding: 0.5rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            width: 100%;
            box-sizing: border-box;
            font-size: 0.9rem;
        }

        .calendar-day:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .calendar-day.has-event {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .calendar-day.has-event.past {
            background-color: #e0e0e0;
            color: #666;
            border-color: #d0d0d0;
        }

        .calendar-day.has-event.inactive {
            background-color: #e0e0e0;
            color: #666;
            border-color: #d0d0d0;
        }

        .calendar-day.today {
            background-color: rgba(58, 110, 165, 0.1);
            border: 1px solid var(--accent-color);
            box-shadow: 0 2px 4px rgba(58, 110, 165, 0.1);
            font-weight: 500;
            transition: var(--transition);
        }

        .calendar-day.highlight {
            background-color: var(--accent-light);
            color: white;
            border-color: var(--accent-light);
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(58, 110, 165, 0.2);
            transition: var(--transition);
        }

        .calendar-day.highlight.past {
            background-color: #c0c0c0;
            color: #666;
            border-color: #b0b0b0;
            transition: var(--transition);
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 0.5rem;
            color: var(--text-light);
            font-size: 0.8rem;
        }

        .event-modal {
            position: fixed;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 1.5rem;
            z-index: 1000;
            max-width: 90%;
            width: 400px;
            will-change: transform, opacity;
        }

        .event-modal.mobile {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
        }

        .event-modal.desktop {
            position: fixed;
            width: 350px;
        }

        .event-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .event-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .event-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 0.25rem;
            line-height: 1;
        }

        .event-modal-close:hover {
            color: var(--accent-color);
        }

        .event-modal-content {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .event-modal-content::-webkit-scrollbar {
            width: 6px;
        }

        .event-modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .event-modal-content::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        .event-modal-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            will-change: opacity;
        }

        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden;
                width: 100%;
            }

            .container {
                padding: 1rem;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }

            .filters {
                margin: -2rem auto 1rem;
                width: 100%;
            }

            .events-section {
                gap: 1rem;
                width: 100%;
            }

            .upcoming-events {
                padding: 1rem;
                max-height: none;
                overscroll-behavior: contain;
                width: 100%;
            }

            .event-card {
                padding: 1rem 0;
                width: 100%;
            }

            .filter-group {
                gap: 0.5rem;
                width: 100%;
            }

            .filter-option {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }

            .calendar {
                min-height: auto;
                width: 100%;
                overflow: hidden;
                padding: 0.5rem;
            }

            .calendar-grid {
                gap: 0.25rem;
            }

            .calendar-day {
                padding: 0.25rem;
                font-size: 0.8rem;
            }

            .calendar-day-header {
                padding: 0.25rem;
                font-size: 0.75rem;
            }

            .event-modal {
                width: 90%;
                max-width: 400px;
                box-sizing: border-box;
            }
        }

        /* Fix touch scrolling */
        .upcoming-events {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        /* Ensure the container doesn't prevent page scrolling */
        @media (max-width: 768px) {
            body {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .container {
                overflow: visible;
            }
        }

        .menu-toggle {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1000;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .menu-toggle span {
            display: block;
            width: 24px;
            height: 2px;
            background-color: white;
            transition: var(--transition);
        }

        .menu-toggle:hover span {
            background-color: var(--accent-light);
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .menu-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background-color: white;
            z-index: 1000;
            transition: left 0.3s ease;
            padding: 2rem 1.5rem;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }

        .menu.visible {
            left: 0;
        }

        .menu-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--accent-color);
        }

        .menu-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        .menu-social {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-light);
            font-size: 0.9rem;
            text-decoration: none;
            transition: var(--transition);
            margin-top: 0.5rem;
        }

        .menu-social img {
            width: 4rem;
            height: 4rem;
            object-fit: contain;
        }

        .instagram-link {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 100;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .instagram-link img {
            width: 5rem;
            height: 5rem;
            object-fit: contain;
        }

        @media (max-width: 768px) {
            .instagram-link {
                bottom: 1rem;
                right: 1rem;
                padding: 0.4rem;
            }

            .instagram-link img {
                width: 4rem;
                height: 4rem;
            }
        }

        .menu-items {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .menu-item {
            padding: 1rem;
            background-color: var(--background-color);
            border-radius: var(--border-radius);
            color: var(--text-color);
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid #e9ecef;
        }

        .menu-item:hover {
            transform: translateX(4px);
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
    </style>
</head>
<body>
    <button class="menu-toggle">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <div class="menu-overlay"></div>
    <div class="menu">
        <div class="menu-header">
            <div class="menu-title">Seattle Blues Underground</div>
            <a href="https://www.instagram.com/seattle.blues.dance.collective/" target="_blank" class="menu-social">
                <img src="https://clipartcraft.com/images/instagram-logo-translucent-4.png" alt="Instagram">
            </a>
        </div>
        <div class="menu-items">
            <div class="menu-item">Events</div>
            <div class="menu-item">About</div>
            <div class="menu-item">Blues History</div>
            <div class="menu-item">Donate</div>
        </div>
    </div>

    <header>
        <div class="header-image">
            Seattle Blues Underground
        </div>
    </header>

    <div class="container">
        <div class="filters">
            <div class="filter-toggle">
                <span class="filter-toggle-text">Filter Events</span>
                <div class="filter-toggle-icon"></div>
            </div>
            <div class="filter-content">
                <div class="filter-group">
                    <div class="filter-label">Location</div>
                    <div class="filter-option active">All Locations</div>
                    <div class="filter-option">Capitol Hill</div>
                    <div class="filter-option">Ballard</div>
                    <div class="filter-option">Fremont</div>
                    <div class="filter-option">Downtown</div>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Time</div>
                    <div class="filter-option active">All Times</div>
                    <div class="filter-option">Weekdays</div>
                    <div class="filter-option">Weekends</div>
                    <div class="filter-option">Evenings</div>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Features</div>
                    <div class="filter-option" data-feature="Live Band">Live Band</div>
                    <div class="filter-option" data-feature="Beginner Lesson">Beginner Lesson</div>
                    <div class="filter-option" data-feature="All Levels">All Levels</div>
                </div>
                <div class="reset-filters">Reset filters</div>
            </div>
        </div>

        <div class="events-section">
            <div class="upcoming-events">
                <h2>Upcoming Events</h2>
                <div class="event-card">
                    <h3 class="event-title">Friday Night Blues</h3>
                    <div class="event-details">
                        <span>7:00 PM - 11:00 PM</span>
                        <span>Capitol Hill</span>
                        <span class="event-tag">Live Band</span>
                        <span class="event-tag">Beginner Lesson</span>
                    </div>
                </div>
                <div class="event-card">
                    <h3 class="event-title">Sunday Social</h3>
                    <div class="event-details">
                        <span>2:00 PM - 6:00 PM</span>
                        <span>Ballard</span>
                        <span class="event-tag">All Levels</span>
                    </div>
                </div>
            </div>

            <div class="calendar">
                <div class="calendar-header">
                    <h2>April 2025</h2>
                    <div class="calendar-controls">
                        <button>Previous</button>
                        <button>Next</button>
                    </div>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                    <div class="calendar-day">1</div>
                    <div class="calendar-day">2</div>
                    <div class="calendar-day has-event">3</div>
                </div>
            </div>
        </div>
    </div>

    <a href="https://www.instagram.com/seattle.blues.dance.collective/" target="_blank" class="instagram-link">
        <img src="https://clipartcraft.com/images/instagram-logo-translucent-4.png" alt="Instagram">
    </a>

    <script>
        // Sample events data
        const events = [
            {
                id: 1,
                title: "Friday Night Blues",
                date: "2025-04-04", // Friday
                time: "7:00 PM - 11:00 PM",
                location: "Capitol Hill",
                features: ["Live Band", "Beginner Lesson"],
                description: "Join us for an evening of blues dancing with live music and a beginner lesson at 7:30 PM."
            },
            {
                id: 1.1,
                title: "Late Night Blues",
                date: "2025-04-04", // Friday
                time: "11:00 PM - 2:00 AM",
                location: "Downtown",
                features: ["Live Band", "All Levels"],
                description: "Keep the party going with late night blues dancing and live music."
            },
            {
                id: 1.2,
                title: "Friday Blues Workshop",
                date: "2025-04-04", // Friday
                time: "5:00 PM - 7:00 PM",
                location: "Capitol Hill",
                features: ["Beginner Lesson", "All Levels"],
                description: "Early evening workshop focusing on blues fundamentals and musicality."
            },
            {
                id: 2,
                title: "Sunday Social",
                date: "2025-04-06", // Sunday
                time: "2:00 PM - 6:00 PM",
                location: "Ballard",
                features: ["All Levels"],
                description: "A relaxed afternoon of blues dancing suitable for all levels."
            },
            {
                id: 3,
                title: "Midweek Blues",
                date: "2025-04-09", // Wednesday
                time: "8:00 PM - 11:00 PM",
                location: "Fremont",
                features: ["Live Band"],
                description: "Midweek blues session with a live band."
            },
            {
                id: 4,
                title: "Blues Underground",
                date: "2025-04-11", // Friday
                time: "9:00 PM - 1:00 AM",
                location: "Downtown",
                features: ["Live Band", "All Levels"],
                description: "Late night blues dancing in the heart of downtown."
            },
            {
                id: 5,
                title: "Sunday Blues Social",
                date: "2025-04-13", // Sunday
                time: "3:00 PM - 7:00 PM",
                location: "Capitol Hill",
                features: ["Beginner Lesson", "All Levels"],
                description: "Sunday afternoon blues with a beginner lesson at 3:30 PM."
            },
            {
                id: 6,
                title: "Tuesday Blues",
                date: "2025-04-15", // Tuesday
                time: "7:30 PM - 10:30 PM",
                location: "Ballard",
                features: ["Beginner Lesson"],
                description: "Perfect for beginners with a lesson at 7:30 PM."
            },
            {
                id: 7,
                title: "Friday Night Live",
                date: "2025-04-18", // Friday
                time: "8:00 PM - 12:00 AM",
                location: "Fremont",
                features: ["Live Band", "All Levels"],
                description: "Friday night blues with a live band and DJ."
            },
            {
                id: 8,
                title: "Saturday Night Special",
                date: "2025-04-19", // Saturday
                time: "9:00 PM - 1:00 AM",
                location: "Downtown",
                features: ["Live Band"],
                description: "Special Saturday night event with live music."
            },
            {
                id: 9,
                title: "Wednesday Workshop",
                date: "2025-04-23", // Wednesday
                time: "7:00 PM - 10:00 PM",
                location: "Capitol Hill",
                features: ["Beginner Lesson", "All Levels"],
                description: "Workshop night with beginner and intermediate lessons."
            },
            {
                id: 10,
                title: "Friday Finale",
                date: "2025-04-25", // Friday
                time: "8:00 PM - 12:00 AM",
                location: "Ballard",
                features: ["Live Band", "All Levels"],
                description: "End the month with a bang! Live band and DJ."
            },
            {
                id: 11,
                title: "Monday Blues",
                date: "2025-04-28", // Monday
                time: "7:00 PM - 10:00 PM",
                location: "Capitol Hill",
                features: ["Beginner Lesson"],
                description: "Start your week with some blues! Beginner lesson at 7:30 PM."
            },
            {
                id: 12,
                title: "Tuesday Night Live",
                date: "2025-04-29", // Tuesday
                time: "8:00 PM - 11:00 PM",
                location: "Fremont",
                features: ["Live Band", "All Levels"],
                description: "Midweek blues with a live band."
            },
            {
                id: 13,
                title: "Saturday Night Fever",
                date: "2025-04-26", // Saturday
                time: "8:00 PM - 12:00 AM",
                location: "Capitol Hill",
                features: ["Live Band", "All Levels"],
                description: "Special Saturday night event with live music and DJ."
            },
            {
                id: 14,
                title: "Mid-May Blues Workshop",
                date: "2025-05-15", // Thursday
                time: "7:00 PM - 10:00 PM",
                location: "Ballard",
                features: ["Beginner Lesson", "All Levels"],
                description: "Special workshop focusing on blues fundamentals and musicality."
            },
            {
                id: 15,
                title: "May Blues Social",
                date: "2025-05-17", // Saturday
                time: "8:00 PM - 12:00 AM",
                location: "Downtown",
                features: ["Live Band", "All Levels"],
                description: "Monthly blues social with live music and DJ."
            },
            {
                id: 16,
                title: "Sunday Afternoon Blues",
                date: "2025-05-18", // Sunday
                time: "2:00 PM - 6:00 PM",
                location: "Fremont",
                features: ["All Levels"],
                description: "Relaxed afternoon of blues dancing suitable for all levels."
            }
        ];

        // Current date handling
        let currentDate = getSeattleDate(); // Use current date instead of hardcoded value
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        // Filter state
        let activeFilters = {
            location: "All Locations",
            time: "All Times",
            features: [] // Changed to array to store multiple features
        };

        // DOM Elements
        const eventsContainer = document.querySelector('.upcoming-events');
        const calendarGrid = document.querySelector('.calendar-grid');
        const filterOptions = document.querySelectorAll('.filter-option');
        const monthYearDisplay = document.querySelector('.calendar h2');

        // Initialize the page
        function initializePage() {
            renderEvents();
            renderCalendar();
            setupEventListeners();
            setupFilterToggle();
            setupMenu();
            checkInstagramOverlap(); // Initial check
        }

        // Filter events based on active filters
        function filterEvents(options = {}) {
            const {
                includePast = true,
                includeInactive = true,
                timeRange = null // null means no time range limit
            } = options;

            const today = getSeattleDate();

            return events.filter(event => {
                const date = createLocalDate(event.date);
                const dayOfWeek = date.getDay();
                
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6; // Sunday (0) or Saturday (6)
                const isEvening = event.time.includes('PM') && !event.time.includes('12:00 PM');
                const isPast = date < today;

                // Check if event matches ALL of the selected features
                const matchesFeatures = activeFilters.features.length === 0 || 
                    activeFilters.features.every(feature => event.features.includes(feature));

                const matchesTime = activeFilters.time === "All Times" ||
                    (activeFilters.time === "Weekends" && isWeekend) ||
                    (activeFilters.time === "Weekdays" && !isWeekend) ||
                    (activeFilters.time === "Evenings" && isEvening);

                const matchesLocation = activeFilters.location === "All Locations" || 
                    event.location === activeFilters.location;

                // Check if event is within time range if specified
                const withinTimeRange = !timeRange || 
                    (date >= today && date <= timeRange);

                // Determine if event should be included based on options
                const shouldInclude = 
                    (includePast || !isPast) && 
                    (includeInactive || (matchesFeatures && matchesTime && matchesLocation)) &&
                    withinTimeRange;

                return shouldInclude;
            });
        }

        // Helper function to create a date in local timezone
        function createLocalDate(dateStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            return new Date(year, month - 1, day, 0, 0, 0, 0);
        }

        // Helper function to get current date in Seattle timezone
        function getSeattleDate() {
            const now = new Date();
            const seattleTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
            return createLocalDate(seattleTime.toISOString().split('T')[0]);
        }

        // Helper function to format date in Seattle timezone
        function formatSeattleDate(date) {
            return date.toLocaleString('en-US', {
                timeZone: 'America/Los_Angeles',
                weekday: 'long',
                month: 'long',
                day: 'numeric'
            });
        }

        // Render calendar
        function renderCalendar() {
            // Create first and last day in Seattle time
            const firstDay = new Date(currentYear, currentMonth, 1);
            firstDay.setHours(0, 0, 0, 0);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            lastDay.setHours(0, 0, 0, 0);
            
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            const today = getSeattleDate();

            // Update month/year display
            monthYearDisplay.textContent = `${getMonthName(currentMonth)} ${currentYear}`;

            // Clear existing calendar days
            while (calendarGrid.children.length > 7) {
                calendarGrid.removeChild(calendarGrid.lastChild);
            }

            // Add empty cells for days before the first of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }

            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const calendarDate = createLocalDate(dateStr);
                const isPast = calendarDate < today;
                
                // Get all events for this day
                const dayEvents = events.filter(event => {
                    const eventDate = createLocalDate(event.date);
                    return eventDate.getTime() === calendarDate.getTime();
                });

                // Check if any events match current filters
                const hasMatchingEvent = dayEvents.some(event => {
                    const date = createLocalDate(event.date);
                    const dayOfWeek = date.getDay();
                    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                    const isEvening = event.time.includes('PM') && !event.time.includes('12:00 PM');

                    const matchesFeatures = activeFilters.features.length === 0 || 
                        activeFilters.features.every(feature => event.features.includes(feature));

                    const matchesTime = activeFilters.time === "All Times" ||
                        (activeFilters.time === "Weekends" && isWeekend) ||
                        (activeFilters.time === "Weekdays" && !isWeekend) ||
                        (activeFilters.time === "Evenings" && isEvening);

                    return (
                        (activeFilters.location === "All Locations" || event.location === activeFilters.location) &&
                        matchesTime &&
                        matchesFeatures
                    );
                });
                
                const hasEvent = dayEvents.length > 0;
                const isToday = calendarDate.getTime() === today.getTime();
                
                const dayElement = document.createElement('div');
                dayElement.className = `calendar-day ${hasEvent ? 'has-event' : ''} ${(isPast || !hasMatchingEvent) ? 'inactive' : ''} ${isToday ? 'today' : ''}`;
                dayElement.textContent = day;
                
                if (hasEvent) {
                    dayElement.style.cursor = 'pointer';
                    dayElement.addEventListener('click', (e) => {
                        showEventModal(dayEvents, calendarDate, e.target);
                    });
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // Get month name
        function getMonthName(month) {
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            return months[month];
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter option clicks
            filterOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const group = option.parentElement;
                    const label = group.querySelector('.filter-label').textContent;
                    
                    if (label === 'Features') {
                        // Toggle the active state for Features
                        option.classList.toggle('active');
                        
                        // Update features array
                        const feature = option.getAttribute('data-feature');
                        if (option.classList.contains('active')) {
                            activeFilters.features.push(feature);
                        } else {
                            activeFilters.features = activeFilters.features.filter(f => f !== feature);
                        }
                    } else {
                        // Remove active class from all options in group
                        group.querySelectorAll('.filter-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        
                        // Add active class to clicked option
                        option.classList.add('active');
                        
                        // Update active filters
                        switch(label) {
                            case 'Location':
                                activeFilters.location = option.textContent;
                                break;
                            case 'Time':
                                activeFilters.time = option.textContent;
                                break;
                        }
                    }
                    
                    // Update reset button visibility
                    updateResetButtonVisibility();
                    
                    // Re-render both events and calendar
                    renderEvents();
                    renderCalendar();
                });
            });

            // Reset filters button
            const resetButton = document.querySelector('.reset-filters');
            resetButton.addEventListener('click', () => {
                // Reset location filter
                document.querySelectorAll('.filter-group')[0].querySelectorAll('.filter-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                document.querySelectorAll('.filter-group')[0].querySelector('.filter-option').classList.add('active');
                activeFilters.location = "All Locations";

                // Reset time filter
                document.querySelectorAll('.filter-group')[1].querySelectorAll('.filter-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                document.querySelectorAll('.filter-group')[1].querySelector('.filter-option').classList.add('active');
                activeFilters.time = "All Times";

                // Reset features filter
                document.querySelectorAll('.filter-group')[2].querySelectorAll('.filter-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                activeFilters.features = [];

                // Hide reset button
                resetButton.classList.remove('visible');

                // Re-render both events and calendar
                renderEvents();
                renderCalendar();
            });

            // Calendar navigation
            document.querySelectorAll('.calendar-controls button').forEach(button => {
                button.addEventListener('click', () => {
                    if (button.textContent === 'Previous') {
                        currentMonth--;
                        if (currentMonth < 0) {
                            currentMonth = 11;
                            currentYear--;
                        }
                    } else {
                        currentMonth++;
                        if (currentMonth > 11) {
                            currentMonth = 0;
                            currentYear++;
                        }
                    }
                    renderCalendar();
                });
            });
        }

        // Update reset button visibility based on active filters
        function updateResetButtonVisibility() {
            const resetButton = document.querySelector('.reset-filters');
            const isDefaultState = 
                activeFilters.location === "All Locations" &&
                activeFilters.time === "All Times" &&
                activeFilters.features.length === 0;
            
            resetButton.classList.toggle('visible', !isDefaultState);
        }

        // Render events based on filters
        function renderEvents() {
            const today = getSeattleDate();
            const twoWeeksFromNow = new Date(today);
            twoWeeksFromNow.setDate(today.getDate() + 14);

            // Filter events for the next two weeks, excluding past and inactive events
            const upcomingEvents = filterEvents({
                includePast: false,
                includeInactive: false,
                timeRange: twoWeeksFromNow
            });

            // Group events by week
            const thisWeek = [];
            const nextWeek = [];

            upcomingEvents.forEach(event => {
                const eventDate = createLocalDate(event.date);
                const daysDiff = Math.floor((eventDate - today) / (1000 * 60 * 60 * 24));
                
                if (daysDiff < 7) {
                    thisWeek.push(event);
                } else {
                    nextWeek.push(event);
                }
            });

            // Sort events by date within each week
            const sortByDate = (a, b) => createLocalDate(a.date) - createLocalDate(b.date);
            thisWeek.sort(sortByDate);
            nextWeek.sort(sortByDate);

            eventsContainer.innerHTML = '<h2>Upcoming Events</h2>';
            
            // Render This Week events
            if (thisWeek.length > 0) {
                const thisWeekSection = document.createElement('div');
                thisWeekSection.className = 'events-week';
                thisWeekSection.innerHTML = '<div class="week-header">This Week</div>';
                
                thisWeek.forEach(event => {
                    const eventCard = createEventCard(event);
                    thisWeekSection.appendChild(eventCard);
                });
                
                eventsContainer.appendChild(thisWeekSection);
            }

            // Render Next Week events
            if (nextWeek.length > 0) {
                const nextWeekSection = document.createElement('div');
                nextWeekSection.className = 'events-week';
                nextWeekSection.innerHTML = '<div class="week-header">Next Week</div>';
                
                nextWeek.forEach(event => {
                    const eventCard = createEventCard(event);
                    nextWeekSection.appendChild(eventCard);
                });
                
                eventsContainer.appendChild(nextWeekSection);
            }

            // Show message if no events
            if (thisWeek.length === 0 && nextWeek.length === 0) {
                eventsContainer.innerHTML += '<p>No upcoming events match your filters.</p>';
            }
        }

        // Helper function to create event card
        function createEventCard(event) {
            const eventDate = createLocalDate(event.date);
            const formattedDate = formatSeattleDate(eventDate);
            
            const eventCard = document.createElement('div');
            eventCard.className = 'event-card';
            eventCard.innerHTML = `
                <div class="event-date">${formattedDate}</div>
                <h3 class="event-title">${event.title}</h3>
                <div class="event-details">
                    <span>${event.time}</span>
                    <span>${event.location}</span>
                    ${event.features.map(feature => 
                        `<span class="event-tag">${feature}</span>`
                    ).join('')}
                </div>
            `;

            // Add hover functionality for non-mobile devices
            if (window.innerWidth > 768) {
                eventCard.addEventListener('mouseenter', () => {
                    const eventMonth = eventDate.getMonth();
                    const eventYear = eventDate.getFullYear();
                    
                    // Only highlight if calendar is showing the same month
                    if (eventMonth === currentMonth && eventYear === currentYear) {
                        const day = eventDate.getDate();
                        const calendarDays = document.querySelectorAll('.calendar-day');
                        calendarDays.forEach(dayElement => {
                            if (parseInt(dayElement.textContent) === day) {
                                dayElement.classList.add('highlight');
                            }
                        });
                    }
                });

                eventCard.addEventListener('mouseleave', () => {
                    const calendarDays = document.querySelectorAll('.calendar-day');
                    calendarDays.forEach(dayElement => {
                        dayElement.classList.remove('highlight');
                    });
                });
            }

            return eventCard;
        }

        // Show event modal
        function showEventModal(events, date, targetElement) {
            // Remove any existing modal
            const existingModal = document.querySelector('.event-modal');
            const existingBackdrop = document.querySelector('.modal-backdrop');
            if (existingModal) existingModal.remove();
            if (existingBackdrop) existingBackdrop.remove();

            // Create modal backdrop
            const backdrop = document.createElement('div');
            backdrop.className = 'modal-backdrop';
            backdrop.addEventListener('click', () => {
                backdrop.remove();
                modal.remove();
            });

            // Create modal
            const modal = document.createElement('div');
            modal.className = `event-modal ${window.innerWidth <= 768 ? 'mobile' : 'desktop'}`;
            
            // Format date
            const formattedDate = formatSeattleDate(date);
            
            // Create modal content
            modal.innerHTML = `
                <div class="event-modal-header">
                    <div class="event-modal-title">${formattedDate}</div>
                    <button class="event-modal-close">&times;</button>
                </div>
                <div class="event-modal-content">
                    ${events.map(event => `
                        <div class="event-card">
                            <h3 class="event-title">${event.title}</h3>
                            <div class="event-details">
                                <span>${event.time}</span>
                                <span>${event.location}</span>
                                ${event.features.map(feature => 
                                    `<span class="event-tag">${feature}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            // Function to close modal
            const closeModal = () => {
                backdrop.remove();
                modal.remove();
                document.removeEventListener('keydown', handleEscape);
            };

            // Handle Escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                }
            };

            // Add event listeners
            document.addEventListener('keydown', handleEscape);
            modal.querySelector('.event-modal-close').addEventListener('click', closeModal);
            backdrop.addEventListener('click', closeModal);

            // Position modal for desktop
            if (window.innerWidth > 768) {
                const calendar = document.querySelector('.calendar');
                const calendarRect = calendar.getBoundingClientRect();
                
                // Calculate center position of calendar
                const centerX = calendarRect.left + (calendarRect.width / 2);
                const centerY = calendarRect.top + (calendarRect.height / 2);
                
                // Position modal at calendar center
                modal.style.left = `${centerX}px`;
                modal.style.top = `${centerY}px`;
                modal.style.transform = 'translate(-50%, -50%)';
            }

            // Add to DOM
            document.body.appendChild(backdrop);
            document.body.appendChild(modal);
        }

        // Add resize listener to handle modal positioning
        window.addEventListener('resize', () => {
            const modal = document.querySelector('.event-modal');
            if (modal) {
                modal.className = `event-modal ${window.innerWidth <= 768 ? 'mobile' : 'desktop'}`;
            }
        });

        // Setup filter toggle functionality
        function setupFilterToggle() {
            const filters = document.querySelector('.filters');
            const toggle = document.querySelector('.filter-toggle');
            const icon = document.querySelector('.filter-toggle-icon');
            const calendar = document.querySelector('.calendar');
            
            // Check if filters were previously collapsed
            const isCollapsed = localStorage.getItem('filtersCollapsed') === 'true';
            if (isCollapsed) {
                filters.classList.add('collapsed');
                icon.classList.add('expanded');
            }

            toggle.addEventListener('click', () => {
                const wasCollapsed = filters.classList.contains('collapsed');
                filters.classList.toggle('collapsed');
                icon.classList.toggle('expanded');
                
                // Save the collapsed state
                localStorage.setItem('filtersCollapsed', filters.classList.contains('collapsed'));

                // Only auto-scroll on desktop
                if (window.innerWidth > 768) {
                    if (wasCollapsed) {
                        // When expanding, wait for the content to be visible
                        const handleExpand = () => {
                            const calendarRect = calendar.getBoundingClientRect();
                            const scrollPosition = window.scrollY + calendarRect.top - 20;
                            window.scrollTo({
                                top: scrollPosition
                            });
                            filters.removeEventListener('transitionend', handleExpand);
                        };
                        
                        // Start listening for the transition to complete
                        filters.addEventListener('transitionend', handleExpand);
                    } else {
                        // If we're collapsing, scroll immediately
                        const filtersRect = filters.getBoundingClientRect();
                        const scrollPosition = window.scrollY + filtersRect.top;
                        window.scrollTo({
                            top: scrollPosition
                        });
                    }
                }
            });
        }

        // Setup menu functionality
        function setupMenu() {
            const menuToggle = document.querySelector('.menu-toggle');
            const menu = document.querySelector('.menu');
            const menuOverlay = document.querySelector('.menu-overlay');
            const menuItems = document.querySelectorAll('.menu-item');

            // Toggle menu
            menuToggle.addEventListener('click', () => {
                menu.classList.toggle('visible');
                menuOverlay.classList.toggle('visible');
            });

            // Close menu when clicking overlay
            menuOverlay.addEventListener('click', () => {
                menu.classList.remove('visible');
                menuOverlay.classList.remove('visible');
            });

            // Menu item hover effects
            menuItems.forEach(item => {
                item.addEventListener('mouseenter', () => {
                    item.style.transform = 'translateX(4px)';
                });

                item.addEventListener('mouseleave', () => {
                    item.style.transform = 'translateX(0)';
                });
            });

            // Close menu when pressing Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && menu.classList.contains('visible')) {
                    menu.classList.remove('visible');
                    menuOverlay.classList.remove('visible');
                }
            });
        }

        // Function to check if Instagram link overlaps with calendar
        function checkInstagramOverlap() {
            if (window.innerWidth > 768) return; // Only check on mobile
            
            const instagramLink = document.querySelector('.instagram-link');
            const calendar = document.querySelector('.calendar');
            
            if (!instagramLink || !calendar) return;
            
            const instagramRect = instagramLink.getBoundingClientRect();
            const calendarRect = calendar.getBoundingClientRect();
            
            // Check if the Instagram link overlaps with the calendar
            const isOverlapping = !(
                instagramRect.bottom < calendarRect.top ||
                instagramRect.top > calendarRect.bottom ||
                instagramRect.right < calendarRect.left ||
                instagramRect.left > calendarRect.right
            );
            
            // Toggle visibility based on overlap
            instagramLink.style.opacity = isOverlapping ? '0' : '1';
            instagramLink.style.pointerEvents = isOverlapping ? 'none' : 'auto';
        }

        // Add event listeners for overlap checking
        window.addEventListener('scroll', checkInstagramOverlap);
        window.addEventListener('resize', checkInstagramOverlap);

        // Initialize the page
        initializePage();
    </script>
</body>
</html> 